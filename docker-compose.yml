version: '3.8'

services:
  stm:
    build:
      context: .
      dockerfile: Dockerfile
    image: stm-transcoder:latest
    container_name: stm

    volumes:
      # 直接映射整个 /mnt 目录，灵活访问所有挂载点
      - /mnt:/mnt
      # 数据库和日志
      - ./data:/data
      # 配置文件（只读）
      - ./configs/config.yaml:/app/config.yaml:ro

    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Shanghai
      # 环境变量覆盖配置（可选）
      # - STM_MAX_WORKERS=3

    ports:
      - "9999:8080"

    restart: unless-stopped

    # 资源限制（可选，根据硬件调整）
    deploy:
      resources:
        limits:
          cpus: '4' # 3500X 6核心
          memory: 3G
        reservations:
          cpus: '2'
          memory: 1G
